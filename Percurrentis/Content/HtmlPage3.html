<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="http://code.jquery.com/jquery-latest.min.js"
            type="text/javascript"></script>
</head>
<body>
    <script type="text/javascript">
        $(document).ready(function () {
            var array = [];
            var doneYet = 0;
            var string = 0;
            $.ajax({
                type: "get",
                dataType: 'json',
                url: 'http://restcountries.eu/rest/v1/all'
            }).done(function (countryData) {
                $(countryData).each(function (index,element) {
                    console.log(element);
    
                    var weatherUrl = "http://api.openweathermap.org/data/2.5/weather?q=";
                    weatherUrl += element.capital + "," + element.alpha2Code;
    
                    $.ajax({
                        type: "get",
                        dataType: 'json',
                        url: weatherUrl
                    }).done(function (weatherData) {
                        console.log(weatherData);
    
                        var obj = {
                            Country: element.name,
                            City: element.capital,
                            NativeName: element.nativeName,
                            Temp: weatherData.main.temp
                            
                        }
                        array.push(obj);
                        string = JSON.stringify(array);
                    });
                });
            });

            setInterval(function () {
                //string = '[{"Country":"Afghanistan","City":"Kabul","Temp":283.15},{"Country":"Angola","City":"Luanda","Temp":304.287},{"Country":"American Samoa","City":"Pago Pago","Temp":299.15},{"Country":"Andorra","City":"Andorra la Vella","Temp":292.37},{"Country":"Anguilla","City":"The Valley","Temp":298.15},{"Country":"Argentina","City":"Buenos Aires","Temp":295.95},{"Country":"Albania","City":"Tirana","Temp":288.15},{"Country":"Armenia","City":"Yerevan","Temp":288.15},{"Country":"Antigua and Barbuda","City":"Saint John\'s","Temp":299.012},{"Country":"Austria","City":"Vienna","Temp":285.21},{"Country":"Aruba","City":"Oranjestad","Temp":299.15},{"Country":"Algeria","City":"Algiers","Temp":288.15},{"Country":"Azerbaijan","City":"Baku","Temp":279.6},{"Country":"The Bahamas","City":"Nassau","Temp":295.15},{"Country":"Belgium","City":"Brussels","Temp":282.87},{"Country":"Bahrain","City":"Manama","Temp":299.6},{"Country":"Belarus","City":"Minsk","Temp":284.41},{"Country":"Australia","City":"Canberra","Temp":288.73},{"Country":"Barbados","City":"Bridgetown","Temp":299.412},{"Country":"Belize","City":"Belmopan","Temp":294.15},{"Country":"Benin","City":"Porto-Novo","Temp":305.15},{"Country":"Bhutan","City":"Thimphu","Temp":273.837},{"Country":"Bolivia","City":"Sucre","Temp":284.012},{"Country":"Bosnia and Herzegovina","City":"Sarajevo","Temp":277.69},{"Country":"Bonaire","City":"Kralendijk","Temp":298.15},{"Country":"Bangladesh","City":"Dhaka","Temp":302.037},{"Country":"Bermuda","City":"Hamilton","Temp":291.15},{"Country":"British Indian Ocean Territory","City":"Diego Garcia","Temp":306.15},{"Country":"British Virgin Islands","City":"Road Town","Temp":277.15},{"Country":"Bouvet Island","City":"","Temp":274.237},{"Country":"Botswana","City":"Gaborone","Temp":302.15},{"Country":"Brazil","City":"Brasília","Temp":295.15},{"Country":"Brunei","City":"Bandar Seri Begawan","Temp":301.03},{"Country":"Bulgaria","City":"Sofia","Temp":275.56},{"Country":"United States Minor Outlying Islands","City":"","Temp":290.937},{"Country":"Burundi","City":"Bujumbura","Temp":302.012},{"Country":"Cameroon","City":"Yaoundé","Temp":302.187},{"Country":"Canada","City":"Ottawa","Temp":268.92},{"Country":"Cape Verde","City":"Praia","Temp":296.15},{"Country":"Cambodia","City":"Phnom Penh","Temp":306.15},{"Country":"Chile","City":"Santiago","Temp":287.15},{"Country":"China","City":"Beijing","Temp":287.02},{"Country":"Central African Republic","City":"Bangui","Temp":308.15},{"Country":"Chad","City":"N\'Djamena","Temp":311.987},{"Country":"Cocos (Keeling) Islands","City":"West Island","Temp":302.15},{"Country":"Colombia","City":"Bogotá","Temp":286.162},{"Country":"Burkina Faso","City":"Ouagadougou","Temp":308.15},{"Country":"Cayman Islands","City":"George Town","Temp":298.15},{"Country":"Croatia","City":"Zagreb","Temp":278.54},{"Country":"Democratic Republic of the Congo","City":"Kinshasa","Temp":303.15},{"Country":"Cook Islands","City":"Avarua","Temp":298.15},{"Country":"Republic of the Congo","City":"Brazzaville","Temp":303.15},{"Country":"Cuba","City":"Havana","Temp":293.15},{"Country":"Cyprus","City":"Nicosia","Temp":297.31},{"Country":"Denmark","City":"Copenhagen","Temp":281.14},{"Country":"Czech Republic","City":"Prague","Temp":283.27},{"Country":"Curaçao","City":"Willemstad","Temp":299.15},{"Country":"Costa Rica","City":"San José","Temp":299.187},{"Country":"Comoros","City":"Moroni","Temp":303.15},{"Country":"Dominica","City":"Roseau","Temp":296.75},{"Country":"Ecuador","City":"Quito","Temp":280.087},{"Country":"Dominican Republic","City":"Santo Domingo","Temp":294.67},{"Country":"El Salvador","City":"San Salvador","Temp":293.99},{"Country":"Eritrea","City":"Asmara","Temp":305.337},{"Country":"Djibouti","City":"Djibouti","Temp":301.387},{"Country":"Estonia","City":"Tallinn","Temp":279.96},{"Country":"Equatorial Guinea","City":"Malabo","Temp":301.437},{"Country":"Egypt","City":"Cairo","Temp":293.97},{"Country":"Ethiopia","City":"Addis Ababa","Temp":298.887},{"Country":"Finland","City":"Helsinki","Temp":281.4},{"Country":"France","City":"Paris","Temp":283.53},{"Country":"Faroe Islands","City":"Tórshavn","Temp":277.15},{"Country":"Gabon","City":"Libreville","Temp":298.15},{"Country":"Georgia","City":"Tbilisi","Temp":277.15},{"Country":"Germany","City":"Berlin","Temp":284.96},{"Country":"French Polynesia","City":"Papeete","Temp":298.91},{"Country":"Ghana","City":"Accra","Temp":305.412},{"Country":"French Guiana","City":"Cayenne","Temp":299.15},{"Country":"Gibraltar","City":"Gibraltar","Temp":289.15},{"Country":"Fiji","City":"Suva","Temp":299.15},{"Country":"Greece","City":"Athens","Temp":285.13},{"Country":"The Gambia","City":"Banjul","Temp":294.15},{"Country":"Guam","City":"Hagatna","Temp":298.44},{"Country":"Guadeloupe","City":"Basse-Terre","Temp":298.937},{"Country":"Guatemala","City":"Guatemala City","Temp":286.15},{"Country":"Grenada","City":"St. George\'s","Temp":298.15},{"Country":"Guinea","City":"Conakry","Temp":300.15},{"Country":"Guernsey","City":"St. Peter Port","Temp":281.61},{"Country":"Guyana","City":"Georgetown","Temp":297.15},{"Country":"Greenland","City":"Nuuk","Temp":255.93},{"Country":"Honduras","City":"Tegucigalpa","Temp":291.15},{"Country":"Guinea-Bissau","City":"Bissau","Temp":295.15},{"Country":"Heard Island and McDonald Islands","City":"","Temp":276.287},{"Country":"Hungary","City":"Budapest","Temp":284.32},{"Country":"India","City":"New Delhi","Temp":295.15},{"Country":"Iceland","City":"Reykjavik","Temp":271.57},{"Country":"Haiti","City":"Port-au-Prince","Temp":295.637},{"Country":"Indonesia","City":"Jakarta","Temp":300.15},{"Country":"Republic of Ireland","City":"Dublin","Temp":285.15},{"Country":"Isle of Man","City":"Douglas","Temp":281.15},{"Country":"Israel","City":"Jerusalem","Temp":297.26},{"Country":"Iraq","City":"Baghdad","Temp":300.68},{"Country":"Italy","City":"Rome","Temp":286.92},{"Country":"Iran","City":"Tehran","Temp":290.41},{"Country":"Ivory Coast","City":"Yamoussoukro","Temp":303.15},{"Country":"Japan","City":"Tokyo","Temp":283.05},{"Country":"Jamaica","City":"Kingston","Temp":298.15},{"Country":"Kenya","City":"Nairobi","Temp":301.07},{"Country":"Kuwait","City":"Kuwait City","Temp":296.15},{"Country":"Kazakhstan","City":"Astana","Temp":273.15},{"Country":"Latvia","City":"Riga","Temp":282.15},{"Country":"Lebanon","City":"Beirut","Temp":296.15},{"Country":"Kyrgyzstan","City":"Bishkek","Temp":280.74},{"Country":"Laos","City":"Vientiane","Temp":306.15},{"Country":"Jersey","City":"Saint Helier","Temp":281.79},{"Country":"Jordan","City":"Amman","Temp":297.15},{"Country":"Lithuania","City":"Vilnius","Temp":283.15},{"Country":"Libya","City":"Tripoli","Temp":287.162},{"Country":"Liberia","City":"Monrovia","Temp":305.15},{"Country":"Liechtenstein","City":"Vaduz","Temp":285.87},{"Country":"Luxembourg","City":"Luxembourg","Temp":282.73},{"Country":"Republic of Macedonia","City":"Skopje","Temp":280.15},{"Country":"Lesotho","City":"Maseru","Temp":294.937},{"Country":"Malawi","City":"Lilongwe","Temp":300.287},{"Country":"Madagascar","City":"Antananarivo","Temp":295.15},{"Country":"Mali","City":"Bamako","Temp":304.15},{"Country":"Maldives","City":"Malé","Temp":304.15},{"Country":"Malaysia","City":"Kuala Lumpur","Temp":299.96},{"Country":"Macau","City":"","Temp":295.4},{"Country":"Malta","City":"Valletta","Temp":286.75},{"Country":"Marshall Islands","City":"Majuro","Temp":301.15},{"Country":"Martinique","City":"Fort-de-France","Temp":297.66},{"Country":"Mayotte","City":"Mamoudzou","Temp":301.15},{"Country":"Mauritius","City":"Port Louis","Temp":299.15},{"Country":"Mauritania","City":"Nouakchott","Temp":293.15},{"Country":"Moldova","City":"Chi?inău","Temp":283.48},{"Country":"Federated States of Micronesia","City":"Palikir","Temp":300.937},{"Country":"Mongolia","City":"Ulan Bator","Temp":259.537},{"Country":"Monaco","City":"Monaco","Temp":289.13},{"Country":"Montserrat","City":"Plymouth","Temp":299.062},{"Country":"Montenegro","City":"Podgorica","Temp":286.25},{"Country":"Morocco","City":"Rabat","Temp":288.15},{"Country":"Mexico","City":"Mexico City","Temp":282.01},{"Country":"Mozambique","City":"Maputo","Temp":303.15},{"Country":"Myanmar","City":"Naypyidaw","Temp":299.437},{"Country":"Namibia","City":"Windhoek","Temp":302.15},{"Country":"Netherlands","City":"Amsterdam","Temp":282.87},{"Country":"Nepal","City":"Kathmandu","Temp":295.15},{"Country":"New Zealand","City":"Wellington","Temp":290.15},{"Country":"New Caledonia","City":"Nouméa","Temp":298.15},{"Country":"Niger","City":"Niamey","Temp":307.15},{"Country":"Nigeria","City":"Abuja","Temp":306.237},{"Country":"Nicaragua","City":"Managua","Temp":279.77},{"Country":"Niue","City":"Alofi","Temp":300.337},{"Country":"Nauru","City":"Yaren","Temp":302.162},{"Country":"North Korea","City":"Pyongyang","Temp":267.262},{"Country":"Norfolk Island","City":"Kingston","Temp":275.15},{"Country":"Northern Mariana Islands","City":"Saipan","Temp":297.15},{"Country":"Norway","City":"Oslo","Temp":282.21},{"Country":"Pakistan","City":"Islamabad","Temp":293.15},{"Country":"Oman","City":"Muscat","Temp":299.512},{"Country":"Panama","City":"Panama City","Temp":301.35},{"Country":"Peru","City":"Lima","Temp":294.15},{"Country":"Poland","City":"Warsaw","Temp":287.12},{"Country":"Papua New Guinea","City":"Port Moresby","Temp":297.15},{"Country":"Philippines","City":"Manila","Temp":301.15},{"Country":"Paraguay","City":"Asunción","Temp":299.96},{"Country":"Portugal","City":"Lisbon","Temp":289.69},{"Country":"Romania","City":"Bucharest","Temp":282.42},{"Country":"Puerto Rico","City":"San Juan","Temp":297.48},{"Country":"Qatar","City":"Doha","Temp":299.37},{"Country":"Réunion","City":"Saint-Denis","Temp":299.15},{"Country":"Pitcairn Islands","City":"Adamstown","Temp":299.437},{"Country":"Russia","City":"Moscow","Temp":280.69},{"Country":"Rwanda","City":"Kigali","Temp":304.15},{"Country":"Saint Kitts and Nevis","City":"Basseterre","Temp":297.15},{"Country":"Saint Barthélemy","City":"Gustavia","Temp":298.15},{"Country":"Saint Helena","City":"Jamestown","Temp":297.512},{"Country":"Saint Martin","City":"Marigot","Temp":298.15},{"Country":"Saint Pierre and Miquelon","City":"Saint-Pierre","Temp":270.162},{"Country":"Saudi Arabia","City":"Riyadh","Temp":305.15},{"Country":"Saint Lucia","City":"Castries","Temp":299.15},{"Country":"Sao Tomé and Príncipe","City":"Sao Tomé","Temp":297.15},{"Country":"Samoa","City":"Apia","Temp":298.93},{"Country":"Seychelles","City":"Victoria","Temp":304.15},{"Country":"Serbia","City":"Belgrade","Temp":282.66},{"Country":"Singapore","City":"Singapore","Temp":300.62},{"Country":"Senegal","City":"Dakar","Temp":292.512},{"Country":"Sierra Leone","City":"Freetown","Temp":302.012},{"Country":"Saint Vincent and the Grenadines","City":"Kingstown","Temp":299.737},{"Country":"Slovenia","City":"Ljubljana","Temp":282.32},{"Country":"Slovakia","City":"Bratislava","Temp":284.9},{"Country":"Sint Maarten","City":"Philipsburg","Temp":298.15},{"Country":"Solomon Islands","City":"Honiara","Temp":298.15},{"Country":"South Korea","City":"Seoul","Temp":269.48},{"Country":"Spain","City":"Madrid","Temp":291.36},{"Country":"South Africa","City":"Pretoria","Temp":296.88},{"Country":"Somalia","City":"Mogadishu","Temp":306.137},{"Country":"Sudan","City":"Khartoum","Temp":312.887},{"Country":"Suriname","City":"Paramaribo","Temp":296.6},{"Country":"Sweden","City":"Stockholm","Temp":282.5},{"Country":"South Sudan","City":"Juba","Temp":312.837},{"Country":"Switzerland","City":"Bern","Temp":285.72},{"Country":"Svalbard and Jan Mayen","City":"Longyearbyen","Temp":271.15},{"Country":"Sri Lanka","City":"Colombo","Temp":302.562},{"Country":"Syria","City":"Damascus","Temp":297.15},{"Country":"Swaziland","City":"Lobamba","Temp":298.837},{"Country":"Taiwan","City":"Taipei","Temp":287.77},{"Country":"Thailand","City":"Bangkok","Temp":303.14},{"Country":"East Timor","City":"Dili","Temp":302.062},{"Country":"Tajikistan","City":"Dushanbe","Temp":286.15},{"Country":"Tanzania","City":"Dodoma","Temp":307.012},{"Country":"Turkey","City":"Ankara","Temp":290.15},{"Country":"Tonga","City":"Nuku\'alofa","Temp":301.287},{"Country":"Tunisia","City":"Tunis","Temp":283.15},{"Country":"Turks and Caicos Islands","City":"Cockburn Town","Temp":297.15},{"Country":"Turkmenistan","City":"Ashgabat","Temp":275.15},{"Country":"Togo","City":"Lomé","Temp":306.15},{"Country":"Trinidad and Tobago","City":"Port of Spain","Temp":297.6},{"Country":"Ukraine","City":"Kiev","Temp":285.56},{"Country":"United Arab Emirates","City":"Abu Dhabi","Temp":303.69},{"Country":"Uganda","City":"Kampala","Temp":302.187},{"Country":"United Kingdom","City":"London","Temp":282.01},{"Country":"Uruguay","City":"Montevideo","Temp":296.7},{"Country":"Uzbekistan","City":"Tashkent","Temp":281.15},{"Country":"Venezuela","City":"Caracas","Temp":294.187},{"Country":"Tuvalu","City":"Funafuti","Temp":302.15},{"Country":"Wallis and Futuna","City":"Mata-Utu","Temp":301.637},{"Country":"Vanuatu","City":"Port Vila","Temp":301.787},{"Country":"United States","City":"Washington D.C.","Temp":273.29},{"Country":"Zambia","City":"Lusaka","Temp":302.137},{"Country":"Yemen","City":"Sana\'a","Temp":298.15},{"Country":"Zimbabwe","City":"Harare","Temp":297.15},{"Country":"Vietnam","City":"Hanoi","Temp":294.937}]';
                var jsonData = JSON.parse(string);

                var byTemp = jsonData.slice(0);
                byTemp.sort(function (a, b) {
                    return a.Temp - b.Temp;
                });
                var html = "<table><tr><td>#</td><td>Country</td><td>NativeName</td><td>City</td><td>Temp (cel)</td></tr>";
                $(byTemp).each(function (i, el) {
                    html += "<tr><td>" + (i + 1) + "</td><td>" + el.Country + "</td><td>" + el.NativeName + "</td><td>" + el.City + "</td><td>" + (Math.round((parseInt(el.Temp) - 273.15) * 100)) / 100 + "</td></tr>";
                });
                //Math.round(num * 100) / 100
                html += "</table>";
                $("#banana").html(html);
            },5000);
        });
    </script>
    <div id="banana"></div>
</body>
</html>
